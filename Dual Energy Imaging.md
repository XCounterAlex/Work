# _Dual Energy Imaging_
## The Problem
Dual Energy Imaging is a method of filtering out specific sections of an image, by comparing two images of the same subject produced by beams of different energy levels- I have named the low energy image the 'base image' and the high energy image the 'target image'. This is useful, for example, when using X-rays to scan an object for abnormalities- such as bones in a fish or cracks in a pipe. These features, while obvious to the human eye are often hard for computers to detect, as there is nothing inherently unique about their colour, intensity, shape or size. Therefore the task presented is to create an image where the bones, cracks or any other desired features, are the only stand out features.
## Overview
In short, to complete this task two images are needed from different energy levels. The two images should be reduced to arrays of pixels and the logarithms of the values of each pixel should be taken. Next take samples of both images, making sure the samples are taken from the same places in each image. Find the linear equation that, in general, describes the transformation from the sample of the base image to the sample of the target image. When this equation is applied to the whole base image, an array of values for a 'predicted' image will be created. Because the features being looked for do not follow the general pattern of the subject, they should be mainly ignored by the equation linking the two images, and therefore be left out of the predicted image. Finally, subtract the predicted array from target image and the result should be an image of just the desired features surrounded by noise.
## Step 1: Manipulating the Data
In order to be easily accessed and manipulated, the base and target images should first be reshaped into arrays. The logarithm of all the values should then be taken. As X-rays propogate through a material, the quantity of photons that are absorbed increases exponentially (as shown below<sup>1</sup>), therefore taking the log of these values creates a linear relationship which is easier to find as very few points are needed to formulate an equation that translates one onto the other.

![alt text](https://teaching.shu.ac.uk/hwb/chemistry/tutorials/molspec/Tvpath.gif "Beer's Law Graph")
## Step 2: Sampling
Taking samples of the images is important, as the images could contain millions of pixels and processing them all would be slow and produce a result that would not necessarily be noticeably better. This could be a random sample, of a size that is appropriate to the images being processed- a low resolution image will not require a large sampe to gain a representitive array of data- but it may make more sense to use a set sample of pixels depending on the nature of your imges. In some images, the background may take up a large section of the data, this is significant as it would then also take up a large section of a random sample and would decrease the accuracy of a predicted image as it would dilute the change in attentuation of X-rays through the actual subject (the attenuation through air is effectively zero over the distance an image is taken in). The only vital point on sampling, is that the same sample of both images is taken, as respective pixels need to be compared. 

## Step 3: Predicting a Model and Making a Final Image
Both sample images should have similar values, as they are both images of the same object just with different energy levels and therefore, once the values of each pixel are logged, both images will be represented as linear graphs that meet at 100% transmission and 0 path length and decrease at different gradients as pathlength increases. This means that there will be a simple linear equation that links the two images. This is the stage that the quality of the sample becomes important, as a sample that includes a lot of background would have a smaller gradient- the background would be the same count rate of 100% in both images and therefore would decrease the average change in each pixel- which would result in a lower quality result. Using this linear equation, form a model by evaluating all the pixels. This should effectively keep the image the same, except for removing any anomalies- such as bones in a fish- because they take up a small minority of the image and therefore dont change the equation signifcantly. In more detail, this model assumes all the X-rays have only gone through one material- which can be assumed is true for the majority of the image- and therefore treats the anomalies in the image where there is one much denser material or no material at all as if its just more of the same material as the rest of the image. The effect of this is to create an image that is very similar to the actual image the equation was trying to create except for the abnormalities which the equation will inevitably 'get wrong', this means the values will be almost exactly the same in the model and the target image for the majority of the images, apart from the abnormalities. To identify these differing respective values, subtract the model from the target image and the result should be a image with only the small, hard to detect features left.

1. Teaching.shu.ac.uk. (2018). [online] Available at: https://teaching.shu.ac.uk/hwb/chemistry/tutorials/molspec/Tvpath.gif [Accessed 8 Aug. 2018].
